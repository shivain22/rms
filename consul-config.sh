#!/bin/bash

# Consul Configuration Management Script
# This script helps you manage configuration in Consul KV store

CONSUL_URL=\"http://localhost:8500\"\nAPP_NAME=\"rms\"\n\necho \"Consul Configuration Management for $APP_NAME\"\necho \"==========================================\"\n\n# Function to set a key-value pair in Consul\nset_consul_kv() {\n    local key=$1\n    local value=$2\n    echo \"Setting $key = $value\"\n    curl -X PUT \"$CONSUL_URL/v1/kv/config/$APP_NAME/$key\" -d \"$value\"\n    echo \"\"\n}\n\n# Function to get a key from Consul\nget_consul_kv() {\n    local key=$1\n    echo \"Getting $key:\"\n    curl -s \"$CONSUL_URL/v1/kv/config/$APP_NAME/$key?raw\"\n    echo \"\"\n}\n\n# Function to list all keys\nlist_consul_keys() {\n    echo \"All configuration keys:\"\n    curl -s \"$CONSUL_URL/v1/kv/config/$APP_NAME/?keys\" | jq -r '.[]'\n}\n\n# Function to load configuration from .env.consul file\nload_env_to_consul() {\n    if [ -f \".env.consul\" ]; then\n        echo \"Loading configuration from .env.consul to Consul...\"\n        while IFS='=' read -r key value; do\n            # Skip comments and empty lines\n            if [[ $key =~ ^#.*$ ]] || [[ -z $key ]]; then\n                continue\n            fi\n            # Convert environment variable format to Consul key format\n            consul_key=$(echo $key | tr '[:upper:]' '[:lower:]' | sed 's/_/\\./g')\n            set_consul_kv \"$consul_key\" \"$value\"\n        done < .env.consul\n    else\n        echo \".env.consul file not found!\"\n    fi\n}\n\n# Main menu\ncase \"$1\" in\n    \"set\")\n        if [ $# -eq 3 ]; then\n            set_consul_kv \"$2\" \"$3\"\n        else\n            echo \"Usage: $0 set <key> <value>\"\n        fi\n        ;;\n    \"get\")\n        if [ $# -eq 2 ]; then\n            get_consul_kv \"$2\"\n        else\n            echo \"Usage: $0 get <key>\"\n        fi\n        ;;\n    \"list\")\n        list_consul_keys\n        ;;\n    \"load\")\n        load_env_to_consul\n        ;;\n    *)\n        echo \"Usage: $0 {set|get|list|load}\"\n        echo \"  set <key> <value> - Set a configuration value\"\n        echo \"  get <key>         - Get a configuration value\"\n        echo \"  list              - List all configuration keys\"\n        echo \"  load              - Load configuration from .env.consul file\"\n        ;;\nesac